<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>《js 设计模式与开发实践》读书笔记 1 | al的前端小屋</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/alblog/icon.jpg">
    <meta name="description" content="">
    
    <link rel="preload" href="/alblog/assets/css/0.styles.d50160af.css" as="style"><link rel="preload" href="/alblog/assets/js/app.355d6781.js" as="script"><link rel="preload" href="/alblog/assets/js/2.03ebf054.js" as="script"><link rel="preload" href="/alblog/assets/js/38.7633100f.js" as="script"><link rel="prefetch" href="/alblog/assets/js/10.8d6ed693.js"><link rel="prefetch" href="/alblog/assets/js/11.c66ee40e.js"><link rel="prefetch" href="/alblog/assets/js/12.41c7cae7.js"><link rel="prefetch" href="/alblog/assets/js/13.63391230.js"><link rel="prefetch" href="/alblog/assets/js/14.245b83a2.js"><link rel="prefetch" href="/alblog/assets/js/15.d752e834.js"><link rel="prefetch" href="/alblog/assets/js/16.2d1a88a9.js"><link rel="prefetch" href="/alblog/assets/js/17.945999d5.js"><link rel="prefetch" href="/alblog/assets/js/18.5d76070c.js"><link rel="prefetch" href="/alblog/assets/js/19.7954c504.js"><link rel="prefetch" href="/alblog/assets/js/20.43324720.js"><link rel="prefetch" href="/alblog/assets/js/21.6f8de43d.js"><link rel="prefetch" href="/alblog/assets/js/22.590f25c8.js"><link rel="prefetch" href="/alblog/assets/js/23.f6867e03.js"><link rel="prefetch" href="/alblog/assets/js/24.9e02e7c8.js"><link rel="prefetch" href="/alblog/assets/js/25.23cf3a4d.js"><link rel="prefetch" href="/alblog/assets/js/26.00523e95.js"><link rel="prefetch" href="/alblog/assets/js/27.476f4fe2.js"><link rel="prefetch" href="/alblog/assets/js/28.cd9806ee.js"><link rel="prefetch" href="/alblog/assets/js/29.389da35f.js"><link rel="prefetch" href="/alblog/assets/js/3.dd5c7757.js"><link rel="prefetch" href="/alblog/assets/js/30.0eb158f4.js"><link rel="prefetch" href="/alblog/assets/js/31.ddc0ff42.js"><link rel="prefetch" href="/alblog/assets/js/32.da0b4c0b.js"><link rel="prefetch" href="/alblog/assets/js/33.610f5551.js"><link rel="prefetch" href="/alblog/assets/js/34.d50062e1.js"><link rel="prefetch" href="/alblog/assets/js/35.dd8c2412.js"><link rel="prefetch" href="/alblog/assets/js/36.082f3f29.js"><link rel="prefetch" href="/alblog/assets/js/37.52c5eeeb.js"><link rel="prefetch" href="/alblog/assets/js/39.617e8325.js"><link rel="prefetch" href="/alblog/assets/js/4.2d2288ad.js"><link rel="prefetch" href="/alblog/assets/js/40.e211bab6.js"><link rel="prefetch" href="/alblog/assets/js/41.36460a4d.js"><link rel="prefetch" href="/alblog/assets/js/42.2fbc3df5.js"><link rel="prefetch" href="/alblog/assets/js/43.7d8d97ba.js"><link rel="prefetch" href="/alblog/assets/js/44.7803b38d.js"><link rel="prefetch" href="/alblog/assets/js/45.526ae1d4.js"><link rel="prefetch" href="/alblog/assets/js/46.418e487f.js"><link rel="prefetch" href="/alblog/assets/js/47.c98cb0c6.js"><link rel="prefetch" href="/alblog/assets/js/48.d3727d20.js"><link rel="prefetch" href="/alblog/assets/js/49.1e76f936.js"><link rel="prefetch" href="/alblog/assets/js/5.d223beea.js"><link rel="prefetch" href="/alblog/assets/js/50.dc3bac3d.js"><link rel="prefetch" href="/alblog/assets/js/51.04ff565a.js"><link rel="prefetch" href="/alblog/assets/js/52.4734d0db.js"><link rel="prefetch" href="/alblog/assets/js/53.9c3e1433.js"><link rel="prefetch" href="/alblog/assets/js/54.77f7978d.js"><link rel="prefetch" href="/alblog/assets/js/55.b23fbe90.js"><link rel="prefetch" href="/alblog/assets/js/56.ca6018fa.js"><link rel="prefetch" href="/alblog/assets/js/57.9e636874.js"><link rel="prefetch" href="/alblog/assets/js/58.2715a001.js"><link rel="prefetch" href="/alblog/assets/js/59.e7885dba.js"><link rel="prefetch" href="/alblog/assets/js/6.35d0bb7f.js"><link rel="prefetch" href="/alblog/assets/js/60.45fd82d3.js"><link rel="prefetch" href="/alblog/assets/js/61.cc0ec143.js"><link rel="prefetch" href="/alblog/assets/js/62.dbedffd7.js"><link rel="prefetch" href="/alblog/assets/js/63.c818127c.js"><link rel="prefetch" href="/alblog/assets/js/64.7d6873dd.js"><link rel="prefetch" href="/alblog/assets/js/65.e48edac3.js"><link rel="prefetch" href="/alblog/assets/js/66.40655f8c.js"><link rel="prefetch" href="/alblog/assets/js/67.c89911f3.js"><link rel="prefetch" href="/alblog/assets/js/68.e2c92813.js"><link rel="prefetch" href="/alblog/assets/js/69.6720353b.js"><link rel="prefetch" href="/alblog/assets/js/7.590c5b12.js"><link rel="prefetch" href="/alblog/assets/js/70.fcd9a8cb.js"><link rel="prefetch" href="/alblog/assets/js/71.c5a43540.js"><link rel="prefetch" href="/alblog/assets/js/72.e08743bb.js"><link rel="prefetch" href="/alblog/assets/js/73.f6cb8cc8.js"><link rel="prefetch" href="/alblog/assets/js/74.7e237eaa.js"><link rel="prefetch" href="/alblog/assets/js/75.e382272e.js"><link rel="prefetch" href="/alblog/assets/js/76.ab365521.js"><link rel="prefetch" href="/alblog/assets/js/77.2ded31f6.js"><link rel="prefetch" href="/alblog/assets/js/78.d82c8ccc.js"><link rel="prefetch" href="/alblog/assets/js/79.129e07fe.js"><link rel="prefetch" href="/alblog/assets/js/8.4a2cf3cb.js"><link rel="prefetch" href="/alblog/assets/js/80.4a461777.js"><link rel="prefetch" href="/alblog/assets/js/81.51401110.js"><link rel="prefetch" href="/alblog/assets/js/82.b4fdcbc1.js"><link rel="prefetch" href="/alblog/assets/js/9.24de0554.js">
    <link rel="stylesheet" href="/alblog/assets/css/0.styles.d50160af.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/alblog/" class="home-link router-link-active"><!----> <span class="site-name">al的前端小屋</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/alblog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/alblog/read/" class="nav-link router-link-active">
  读书
</a></div><div class="nav-item"><a href="/alblog/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/alblog/skill/" class="nav-link">
  技术
</a></div><div class="nav-item"><a href="/alblog/vue/" class="nav-link">
  Vue.js
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/alblog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/alblog/read/" class="nav-link router-link-active">
  读书
</a></div><div class="nav-item"><a href="/alblog/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/alblog/skill/" class="nav-link">
  技术
</a></div><div class="nav-item"><a href="/alblog/vue/" class="nav-link">
  Vue.js
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>重构：改善既有代码的设计</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javascript忍者秘籍</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>《深入解析CSS》</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>《js设计模式与开发实践》</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/alblog/read/designMode/14.html" class="sidebar-link">js设计模式与开发实践14(完)</a></li><li><a href="/alblog/read/designMode/13.html" class="sidebar-link">js设计模式与开发实践13</a></li><li><a href="/alblog/read/designMode/12.html" class="sidebar-link">js设计模式与开发实践12</a></li><li><a href="/alblog/read/designMode/11.html" class="sidebar-link">js设计模式与开发实践11</a></li><li><a href="/alblog/read/designMode/10.html" class="sidebar-link">js设计模式与开发实践10</a></li><li><a href="/alblog/read/designMode/9.html" class="sidebar-link">js设计模式与开发实践9</a></li><li><a href="/alblog/read/designMode/8.html" class="sidebar-link">js设计模式与开发实践8</a></li><li><a href="/alblog/read/designMode/7.html" class="sidebar-link">js设计模式与开发实践7</a></li><li><a href="/alblog/read/designMode/6.html" class="sidebar-link">js设计模式与开发实践6</a></li><li><a href="/alblog/read/designMode/5.html" class="sidebar-link">js设计模式与开发实践5</a></li><li><a href="/alblog/read/designMode/4.html" class="sidebar-link">js设计模式与开发实践4</a></li><li><a href="/alblog/read/designMode/3.html" class="sidebar-link">js设计模式与开发实践3</a></li><li><a href="/alblog/read/designMode/2.html" class="sidebar-link">js设计模式与开发实践2</a></li><li><a href="/alblog/read/designMode/1.html" aria-current="page" class="active sidebar-link">js设计模式与开发实践1</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>《写给大家看的设计书》</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>《你不知道的JavaScript》(中)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>《你不知道的JavaScript》(上)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>《Javascript悟道》</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>《程序员修炼之道》</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>《程序员的 38 堂成长课》</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="《js-设计模式与开发实践》读书笔记-1"><a href="#《js-设计模式与开发实践》读书笔记-1" class="header-anchor">#</a> 《js 设计模式与开发实践》读书笔记 1</h1> <img src="/alblog/assets/img/1.8452df02.jpeg"> <hr> <p>  设计模式的定义是：在面向对象软件设计过程中针对特定问题的简洁而优雅的解决方案。通俗一点说，设计模式是在某种场合下对某个问题的一种解决方案。再通俗点，设计模式是给面向对象开发中一些好的设计取个名字。我们都知道设计经验非常重要。也许你有过这种感觉：这个问题发生的场景似曾相识，以前我遇到并解决过这个问题，但是我不知道怎么跟别人去描述它。each 函数我们都知道，用来迭代一个数组，一个新手很难想到说这个 each 函数其实就是迭代器模式。于是向别人描述这个函数结构和意图的时候会遇到困难，而一旦大家对迭代器模式这个名称达成了共识，剩下的交流便是自然而然的事情。</p> <p>  在软件设计中，模式是一些经过了大量实际项目验证的优秀解决方案。熟悉这些模式的程序员，对某些模式也许形成了条件反射。当合适的场景出现时，她们可以很快地找到某种模式作为解决方案。</p> <p>  设计模式被一些人认为是夸夸其谈的东西，这些人认为设计模式并没有多大用途。毕竟我们用普通的方法就能解决的问题，使用设计模式可能会增加复杂度，或带来一些额外的代码。如果对一些设计模式使用不当，事情还可能变得更糟。从某些角度来看，设计模式确实有可能带来代码量的增加，或许也会把系统的逻辑搞得更复杂。但软件的开发成本并非全部在开发阶段，设计模式的作用是让人们写出可复用和可维护性高的程序。假设有一个空房间，我们要日复一日地往里面放一些东西。最简单的方法当然把这些东西直接扔进去，但时间久了，就会发现很难从这个房子里找打自己想要的东西，要调整某几样东西的位置也不容易。素以在房间里做一些柜子也许是个更好的选择，虽然柜子会增加我们的成本，但它可以在维护阶段为我们带来好处。使用这些柜子存放东西的规则，或许就是一种模式。</p> <p>  所有设计模式的实现都遵循一条原则，“找出程序中变化的地方，并将变化封装起来”。一个程序设计总是可以分为可变的部分和不变的部分。当我们找出可变的部分，并且把这些部分封装起来，那么剩下的就是不变和稳定的部分。这些不变和稳定的部分是非常容易复用的。设计模式被人误解的一个重要原因是人们对它的误用和滥用，比如将一些模式用在了错误的场景中或者说不该使用模式的地方刻意使用模式。初学者刚学会一个模式，恨不得所以代码都用这个模式实现。锤子理论：当我们有了一把锤子，看什么都是钉子。</p> <p>  在设计模式的学习中，会发现，代理模式和装饰者模式，策略模式和状态模式，策略模式和智能命令模式，这些模式的类图看起来几乎一模一样，模式只有放在具体的环境下才有意义。比如我们手机，打电话时，它是电话，闹钟响时它是闹钟，玩游戏时它是游戏机。很多模式的类图和结构确实很相似，辨别模式的关键是这个模式出现的场景，以及为我们解决了什么。</p> <p>  js 没有提供面向对象语言中的类式继承，而是通过原型委托的方式实现对象与对象之间的继承。编程语言按照数据类型大体可以分为两类，一类是静态类型语言，另一类是动态类型语言。静态类型语言在编译时变已经确定变量的类型，而动态型语言的变量类型要到程序运行的时候，待变量被赋予某个值之后，才会具有某种类型。</p> <p>  静态类型语言的优点首先是在编译时就能发现类型不匹配的错误，编辑器可以帮助我们提前避免程序在运行期间有可能发生的一些错误。其次，如果在程序中明确地规定了数据类型，编译器还可以针对这些信息对程序进行一些优化工作，提高程序执行速度。静态类型语言的缺点首先是迫使程序员依照强契约来编写程序，为每个变量规定数据类型，归根结底只是辅助我们编写可靠性高程序的一种手段，而不是编写程序的目的，毕竟我们编写程序的目的是为了完成需求交付生产。其次，类型的声明也会增加更多的代码，在程序编写过程中，这些细节会让程序员的精力从思考业务逻辑上分散开来。</p> <p>  动态类型语言的优点是编写的代码数量更少，看起来也更简洁，可以把精力更多放在业务逻辑上面。动态类型语言的缺点是无法保证变量的类型，从而在程序的运行期有可能发生跟类型相关的错误。</p> <p>  js 是什么类型的语言呢。它是一门典型的动态类型语言。动态类型语言对变量类型的宽容给实际编码带来了很大的灵活性。由于无需进行类型检测，我们可以尝试调用任何对象的任意方法，而无需考虑它原本是否被设计为拥有该方法。这一切都建立在鸭子类型 duck typing 的概念上。鸭子类型的通俗说法是：如果它走起来像鸭子，叫起来像鸭子，那么它就是鸭子。</p> <p>  讲过故事，有个 js 王国，国王觉得世界上最美妙的声音就是鸭子的叫声，于是他要组建一个 1000 只鸭子的合唱团，只是找遍全国，只有 999 只鸭子，最终还是差一只，大臣发现一只鸡叫声和鸭子一模一样，于是这只鸡就成为了合唱团的最后一员。这个故事意思是，国王要的只是鸭子的叫声，声音的主人是谁不重要。鸭子类型指导我们只关注对象的行为，而不关注对象本身。也就是关注 HAS-A,而不是 IS-A。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> duck <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">duckSinging</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'gagaga'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> chicken <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">duckSinging</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'gagaga'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> choir <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">var</span> <span class="token function-variable function">joinChoir</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">animal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>animal <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> animal<span class="token punctuation">.</span>duckSinging <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    choir<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>animal<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'welcome to choir'</span><span class="token punctuation">,</span> choir<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">joinChoir</span><span class="token punctuation">(</span>duck<span class="token punctuation">)</span>
<span class="token function">joinChoir</span><span class="token punctuation">(</span>chicken<span class="token punctuation">)</span>
</code></pre></div><p>  我们看到只要它们拥有 duckSinging 方法，就可以加入合唱团。在动态类型语言的面向对象设计中，鸭子类型的概念至关重要。利用鸭子类型的思想，我们不必借助于超类型的帮助，就能轻松在动态语言中实现一个原则：面向接口编程，而不是面向实现编程。例如一个对象若有 push 和 pop 方法，并且这些方法提供了正确的实现，它可以被当作栈来使用。一个对象如果有 length 属性，也可以依照下标来存取属性，这个对象就可以被当作数组来使用。在 js 中，面向接口编程的过程跟主流的静态类型语言不一样，因此，在 js 中实现设计模式的过程也与我们熟悉的语言中实现的过程会大相径庭。</p> <p>  面向对象语言经常说的三种封装，继承，多态。多态的含义是：同一操作作用于不同的对象上面，可以产生不同的解释和不同的执行结果。换句话说，给不同的对象发送同一个消息的时候，这些对象会根据这个消息分别给出不同的反馈。从字面上理解比较困难，举个例子：家里养了只猫，养了只狗，当你向它们发出叫的命令时，一只喵喵喵，一只汪汪汪。它们都是动物，并且可以发出叫声，根据命令，发出不同的叫声。这里，就蕴含了多态的思想。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">makeSound</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">animal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>animal <span class="token keyword">instanceof</span> <span class="token class-name">Cat</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'miaomiaomiao'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>animal <span class="token keyword">instanceof</span> <span class="token class-name">Dog</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'wangwang'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token function-variable function">Cat</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">var</span> <span class="token function-variable function">Dog</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">var</span> objCat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">makeSound</span><span class="token punctuation">(</span>objCat<span class="token punctuation">)</span> <span class="token comment">//miaomiaomiao</span>
<span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//wangwang</span>
</code></pre></div><p>  instanceof 运算符用于检测构造函数的 prototype 属性是否出现在某个实例对象的原型链上。objCat instanceof Object //true。上面代码中体现了多态性，但是当我们再加入动物时，我们得继续改动 makeSound 函数，才能让他发出声音，当动物越来越多，makeSound 有可能变成一个具体的函数。</p> <p>  多态的思想是将做什么和谁去做以及怎么去做分离开，也就是将不变的事物和可能改变的事物分离开来。在这个故事中，动物都会叫，这是不变的，但是不同类型的动物具体怎么叫是可变的。把不变的部分隔离出来，把可变的部分封装起来，这给予了我们扩展程序的能力，程序看起来是可生长的，也是符合开放-封闭原则的。相对于修改代码来说，仅仅增加代码就能完成同样的功能，这显然优雅和安全得多。所以我们怎么做呢？</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">makeSound</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">animal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  animal<span class="token punctuation">.</span><span class="token function">sound</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token function-variable function">Cat</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token class-name">Cat</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sound</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'miaomiao'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> <span class="token function-variable function">Dog</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token class-name">Dog</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sound</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'wangwang'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token function-variable function">Pig</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token class-name">Pig</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sound</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hengheng'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> objCat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">makeSound</span><span class="token punctuation">(</span>objCat<span class="token punctuation">)</span> <span class="token comment">//miaomiaomiao</span>
<span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//wangwang</span>
<span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Pig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//hengheng</span>
</code></pre></div><p>  现在我们向猫和狗都发出叫的消息，他们接到消息做出不同反应，如果有一天动物增加了。这时候简单追加一些代码就好了，而不需要改动以前的。</p> <p>  类型检查时在表现出对象多态性之前一个绕不开的话题，但是 js 时一门不必进行类型检查的动态类型语言，但是为了了解多态的目的，我们要从静态类型语言讲起。静态类型会在编译时进行类型匹配检查。以 java 为例，由于代码编译时进行严格的类型检查，所以不能给变量赋予不同类型的值，这种类型检查有时候会让代码显得僵硬。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> str<span class="token punctuation">;</span>
str<span class="token operator">=</span><span class="token string">&quot;abc&quot;</span> <span class="token comment">//没问题</span>
str<span class="token operator">=</span><span class="token number">2</span> <span class="token comment">//报错。</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cat</span><span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>'miaomiaomiao'<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Dog</span><span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>'wangwang'<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AnimalSound</span><span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token class-name">Cat</span> cat<span class="token punctuation">)</span><span class="token punctuation">{</span>
    cat<span class="token punctuation">.</span><span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">AnimalSound</span> animalSound <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnimalSound</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token class-name">Cat</span> cat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    animalSound<span class="token punctuation">.</span><span class="token function">makeSound</span><span class="token punctuation">(</span>cat<span class="token punctuation">)</span> <span class="token comment">// miaomiaomiao</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>   我们已经顺利让猫叫出声，但是如果现在想要狗也叫出来，发现不行，因为 AnimalSound 中的 makeSound，只接收 Cat 类型的参数。为了解决这个问题，静态类型的面向对象语言通常被设计为可以向上转型：当给一个变量赋值时，这个变量的类型可以使用这个类本身，也可以使用这个类的超类。类似我们在描述天上的一只麻雀或一只喜鹊时，通常说一只麻雀在天上飞，或者一只喜鹊在天上飞。但如果想忽略它们的具体类型，那么也可以说一只鸟在飞。同理，当 Cat 和 Dog 对象的类型都隐藏在超类型 Animal 身后，Cat 对象和 Dog 对象就能被交换使用，这是让对象表现出多态性的必经之路，而多态性的表现正是实现众多设计模式的目标。</p> <p>  使用继承来得到多态效果，是让对象表现出多态性的最常用手段。继承通常包括实现继承和接口继承。我们先创建一个 Animal 抽象类，再分别让 Cat 和 Dog 都继承自 Animal 抽象类。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Animal</span><span class="token punctuation">{</span>
  <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//抽象方法</span>
<span class="token punctuation">}</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span><span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">priintln</span><span class="token punctuation">(</span>'miaomiaomiao'<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span><span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    system<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>'wangwang'<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name">Animal</span> cat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Animal</span> dog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AnimalSound</span><span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token class-name">Animal</span> animal<span class="token punctuation">)</span><span class="token punctuation">{</span>
    animal<span class="token punctuation">.</span><span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>string args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">AnimalSound</span> animalSound <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnimalSound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Animal</span> cat <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Animal</span> dog <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    animalSound<span class="token punctuation">.</span><span class="token function">makeSound</span><span class="token punctuation">(</span>cat<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// miao</span>
    animalSound<span class="token punctuation">.</span><span class="token function">makeSound</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// wang</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>  多态的思想实际上是把做什么和谁去做分离开，要实现这一点，就是要消除类型之间的耦合关系。在 java 中，可以通过向上转型来实现多态。而 js 的变量类型在运行期是可变的。一个 js 对象，既可以表示 dog 类型对象，也可以表示 cat 类型对象，这意味 js 对象的多态性是与生俱来的。</p> <p>  多态的最根本好处在于，你不必在向对象询问你是什么类型而后根据得到的答案调用对象的某个行为，你只管调用该行为就是来。其他的一切多态机制都会为你安排妥当。换句话说，多态最根本的作用就是通过把过程化的条件分支语句转换为对象的多态性，从而消除这些条件的分支语句。举个例子：在拍电影，当导演喊出 action 时，主角开始背台词，照明时负责打灯光，后面的群众演员假装中枪倒地，道具师给镜头里撒雪花。在得到同一个消息时，每个对象都知道自己应该做什么。如果不利用对象的多态性，而是用面向过程的方式来编写这一段代码，那么相当于在电影开始拍摄之后，导演每次都要走到每个人面前，确认他们的工种，然后告诉他们做什么。如果写在程序里，里面会充斥条件分支语句。利用对象的多态性，导演在发布消息时，就不必考虑各个对象接到消息后应该做什么，对象应该做什么不是临时决定的，而是已经事先约定和排练完毕的。每个对象做什么，已经成了该对象的一个方法，被放在对象的内部，每个对象负责他们自己的行为，所以这些对象可以根据同一个消息，有条不紊的进行各自的工作。将行为分布在各个对象中，并让这些对象各自负责自己的行为，这正是面向对象设计的优点。</p> <p>  看一个现实开发中遇到的例子，这个例子的思想和动物叫声的故事非常相似。假设我们编写一个地图应用，我们选择谷歌地图，通过 api 中的 show 方法，负责在页面上展示整个地图。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> googleMap <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">show</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'渲染地图'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token function-variable function">renderMap</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  googleMap<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">renderMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>  后来某些原因，要把谷歌地图换成百度地图，为了让 renderMap 函数保持一定的弹性，我们用一些条件分支来让 renderMap 函数同时支持谷歌地图和百度地图。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> googleMap <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">show</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'渲染地图'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> baiduMap <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">show</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'渲染百度地图'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token function-variable function">renderMap</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'google'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    googleMap<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token string">'baidu'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    baiduMap<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">renderMap</span><span class="token punctuation">(</span><span class="token string">'google'</span><span class="token punctuation">)</span>
<span class="token function">renderMap</span><span class="token punctuation">(</span><span class="token string">'baidu'</span><span class="token punctuation">)</span>
</code></pre></div><p>  这种弹性很脆弱，一旦换成腾讯地图，必须要修改 renderMap 函数，继续往里面堆砌条件分支语句。我们还是要先把程序中相同的部分抽象出来，就是显示地图。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">renderMap</span> <span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">map</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span>show instaceof Function<span class="token punctuation">)</span><span class="token punctuation">{</span>
    map<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">renderMap</span><span class="token punctuation">(</span>googleMap<span class="token punctuation">)</span>
<span class="token function">renderMap</span><span class="token punctuation">(</span>baiduMap<span class="token punctuation">)</span>

<span class="token keyword">var</span> tengxunMap<span class="token operator">=</span><span class="token punctuation">{</span>
  <span class="token function-variable function">show</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'tengxun ditu'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">renderMap</span><span class="token punctuation">(</span>tengxunMap<span class="token punctuation">)</span>
</code></pre></div><p>  在这个例子中，我们假设每个地图API提供展示地图的方法都是show,在实际开发中也许不会如此顺利，这时候可以借助适配器模式来解决问题。那就是下次了！</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/alblog/read/designMode/2.html" class="prev">
        js设计模式与开发实践2
      </a></span> <span class="next"><a href="/alblog/read/designForEveryone/6.html">
        写给大家看的设计书读书笔记6
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/alblog/assets/js/app.355d6781.js" defer></script><script src="/alblog/assets/js/2.03ebf054.js" defer></script><script src="/alblog/assets/js/38.7633100f.js" defer></script>
  </body>
</html>
