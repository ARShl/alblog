<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>《js 设计模式与开发实践》读书笔记 12 | al的前端小屋</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/alblog/icon.jpg">
    <meta name="description" content="">
    
    <link rel="preload" href="/alblog/assets/css/0.styles.d50160af.css" as="style"><link rel="preload" href="/alblog/assets/js/app.355d6781.js" as="script"><link rel="preload" href="/alblog/assets/js/2.03ebf054.js" as="script"><link rel="preload" href="/alblog/assets/js/41.36460a4d.js" as="script"><link rel="prefetch" href="/alblog/assets/js/10.8d6ed693.js"><link rel="prefetch" href="/alblog/assets/js/11.c66ee40e.js"><link rel="prefetch" href="/alblog/assets/js/12.41c7cae7.js"><link rel="prefetch" href="/alblog/assets/js/13.63391230.js"><link rel="prefetch" href="/alblog/assets/js/14.245b83a2.js"><link rel="prefetch" href="/alblog/assets/js/15.d752e834.js"><link rel="prefetch" href="/alblog/assets/js/16.2d1a88a9.js"><link rel="prefetch" href="/alblog/assets/js/17.945999d5.js"><link rel="prefetch" href="/alblog/assets/js/18.5d76070c.js"><link rel="prefetch" href="/alblog/assets/js/19.7954c504.js"><link rel="prefetch" href="/alblog/assets/js/20.43324720.js"><link rel="prefetch" href="/alblog/assets/js/21.6f8de43d.js"><link rel="prefetch" href="/alblog/assets/js/22.590f25c8.js"><link rel="prefetch" href="/alblog/assets/js/23.f6867e03.js"><link rel="prefetch" href="/alblog/assets/js/24.9e02e7c8.js"><link rel="prefetch" href="/alblog/assets/js/25.23cf3a4d.js"><link rel="prefetch" href="/alblog/assets/js/26.00523e95.js"><link rel="prefetch" href="/alblog/assets/js/27.476f4fe2.js"><link rel="prefetch" href="/alblog/assets/js/28.cd9806ee.js"><link rel="prefetch" href="/alblog/assets/js/29.389da35f.js"><link rel="prefetch" href="/alblog/assets/js/3.dd5c7757.js"><link rel="prefetch" href="/alblog/assets/js/30.0eb158f4.js"><link rel="prefetch" href="/alblog/assets/js/31.ddc0ff42.js"><link rel="prefetch" href="/alblog/assets/js/32.da0b4c0b.js"><link rel="prefetch" href="/alblog/assets/js/33.610f5551.js"><link rel="prefetch" href="/alblog/assets/js/34.d50062e1.js"><link rel="prefetch" href="/alblog/assets/js/35.dd8c2412.js"><link rel="prefetch" href="/alblog/assets/js/36.082f3f29.js"><link rel="prefetch" href="/alblog/assets/js/37.52c5eeeb.js"><link rel="prefetch" href="/alblog/assets/js/38.7633100f.js"><link rel="prefetch" href="/alblog/assets/js/39.617e8325.js"><link rel="prefetch" href="/alblog/assets/js/4.2d2288ad.js"><link rel="prefetch" href="/alblog/assets/js/40.e211bab6.js"><link rel="prefetch" href="/alblog/assets/js/42.2fbc3df5.js"><link rel="prefetch" href="/alblog/assets/js/43.7d8d97ba.js"><link rel="prefetch" href="/alblog/assets/js/44.7803b38d.js"><link rel="prefetch" href="/alblog/assets/js/45.526ae1d4.js"><link rel="prefetch" href="/alblog/assets/js/46.418e487f.js"><link rel="prefetch" href="/alblog/assets/js/47.c98cb0c6.js"><link rel="prefetch" href="/alblog/assets/js/48.d3727d20.js"><link rel="prefetch" href="/alblog/assets/js/49.1e76f936.js"><link rel="prefetch" href="/alblog/assets/js/5.d223beea.js"><link rel="prefetch" href="/alblog/assets/js/50.dc3bac3d.js"><link rel="prefetch" href="/alblog/assets/js/51.04ff565a.js"><link rel="prefetch" href="/alblog/assets/js/52.4734d0db.js"><link rel="prefetch" href="/alblog/assets/js/53.9c3e1433.js"><link rel="prefetch" href="/alblog/assets/js/54.77f7978d.js"><link rel="prefetch" href="/alblog/assets/js/55.b23fbe90.js"><link rel="prefetch" href="/alblog/assets/js/56.ca6018fa.js"><link rel="prefetch" href="/alblog/assets/js/57.9e636874.js"><link rel="prefetch" href="/alblog/assets/js/58.2715a001.js"><link rel="prefetch" href="/alblog/assets/js/59.e7885dba.js"><link rel="prefetch" href="/alblog/assets/js/6.35d0bb7f.js"><link rel="prefetch" href="/alblog/assets/js/60.45fd82d3.js"><link rel="prefetch" href="/alblog/assets/js/61.cc0ec143.js"><link rel="prefetch" href="/alblog/assets/js/62.dbedffd7.js"><link rel="prefetch" href="/alblog/assets/js/63.c818127c.js"><link rel="prefetch" href="/alblog/assets/js/64.7d6873dd.js"><link rel="prefetch" href="/alblog/assets/js/65.e48edac3.js"><link rel="prefetch" href="/alblog/assets/js/66.40655f8c.js"><link rel="prefetch" href="/alblog/assets/js/67.c89911f3.js"><link rel="prefetch" href="/alblog/assets/js/68.e2c92813.js"><link rel="prefetch" href="/alblog/assets/js/69.6720353b.js"><link rel="prefetch" href="/alblog/assets/js/7.590c5b12.js"><link rel="prefetch" href="/alblog/assets/js/70.fcd9a8cb.js"><link rel="prefetch" href="/alblog/assets/js/71.c5a43540.js"><link rel="prefetch" href="/alblog/assets/js/72.e08743bb.js"><link rel="prefetch" href="/alblog/assets/js/73.f6cb8cc8.js"><link rel="prefetch" href="/alblog/assets/js/74.7e237eaa.js"><link rel="prefetch" href="/alblog/assets/js/75.e382272e.js"><link rel="prefetch" href="/alblog/assets/js/76.ab365521.js"><link rel="prefetch" href="/alblog/assets/js/77.2ded31f6.js"><link rel="prefetch" href="/alblog/assets/js/78.d82c8ccc.js"><link rel="prefetch" href="/alblog/assets/js/79.129e07fe.js"><link rel="prefetch" href="/alblog/assets/js/8.4a2cf3cb.js"><link rel="prefetch" href="/alblog/assets/js/80.4a461777.js"><link rel="prefetch" href="/alblog/assets/js/81.51401110.js"><link rel="prefetch" href="/alblog/assets/js/82.b4fdcbc1.js"><link rel="prefetch" href="/alblog/assets/js/9.24de0554.js">
    <link rel="stylesheet" href="/alblog/assets/css/0.styles.d50160af.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/alblog/" class="home-link router-link-active"><!----> <span class="site-name">al的前端小屋</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/alblog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/alblog/read/" class="nav-link router-link-active">
  读书
</a></div><div class="nav-item"><a href="/alblog/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/alblog/skill/" class="nav-link">
  技术
</a></div><div class="nav-item"><a href="/alblog/vue/" class="nav-link">
  Vue.js
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/alblog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/alblog/read/" class="nav-link router-link-active">
  读书
</a></div><div class="nav-item"><a href="/alblog/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/alblog/skill/" class="nav-link">
  技术
</a></div><div class="nav-item"><a href="/alblog/vue/" class="nav-link">
  Vue.js
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>重构：改善既有代码的设计</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javascript忍者秘籍</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>《深入解析CSS》</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>《js设计模式与开发实践》</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/alblog/read/designMode/14.html" class="sidebar-link">js设计模式与开发实践14(完)</a></li><li><a href="/alblog/read/designMode/13.html" class="sidebar-link">js设计模式与开发实践13</a></li><li><a href="/alblog/read/designMode/12.html" aria-current="page" class="active sidebar-link">js设计模式与开发实践12</a></li><li><a href="/alblog/read/designMode/11.html" class="sidebar-link">js设计模式与开发实践11</a></li><li><a href="/alblog/read/designMode/10.html" class="sidebar-link">js设计模式与开发实践10</a></li><li><a href="/alblog/read/designMode/9.html" class="sidebar-link">js设计模式与开发实践9</a></li><li><a href="/alblog/read/designMode/8.html" class="sidebar-link">js设计模式与开发实践8</a></li><li><a href="/alblog/read/designMode/7.html" class="sidebar-link">js设计模式与开发实践7</a></li><li><a href="/alblog/read/designMode/6.html" class="sidebar-link">js设计模式与开发实践6</a></li><li><a href="/alblog/read/designMode/5.html" class="sidebar-link">js设计模式与开发实践5</a></li><li><a href="/alblog/read/designMode/4.html" class="sidebar-link">js设计模式与开发实践4</a></li><li><a href="/alblog/read/designMode/3.html" class="sidebar-link">js设计模式与开发实践3</a></li><li><a href="/alblog/read/designMode/2.html" class="sidebar-link">js设计模式与开发实践2</a></li><li><a href="/alblog/read/designMode/1.html" class="sidebar-link">js设计模式与开发实践1</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>《写给大家看的设计书》</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>《你不知道的JavaScript》(中)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>《你不知道的JavaScript》(上)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>《Javascript悟道》</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>《程序员修炼之道》</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>《程序员的 38 堂成长课》</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="《js-设计模式与开发实践》读书笔记-12"><a href="#《js-设计模式与开发实践》读书笔记-12" class="header-anchor">#</a> 《js 设计模式与开发实践》读书笔记 12</h1> <img src="/alblog/assets/img/1.8452df02.jpeg"> <hr> <p>  享元 flyweight 模式是一种性能优化模式，享元可以理解成共享元对象。享元模式的核心是运用共享技术来有效支持大量细粒度的对象。如果系统中因为创建了大量类似的对象而导致内存占用过高，享元模式的概念听起来不太好理解，我们来看一个例子。</p> <p>  假设爱慕的产品。有 59 种男士内衣，50 件女士内衣。为了推销产品，工厂决定生产一些塑料模特来穿上他们的内衣拍成广告照片。正常情况下需要 50 个男模特和 50 个女模特。假如不用享元模式，可能会写成这样。后面的代码会越来越不像人写的。我们只看思想。然后看如何结合我们的写法。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">Model</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">sex<span class="token punctuation">,</span> underwear</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex
  <span class="token keyword">this</span><span class="token punctuation">.</span>underwear <span class="token operator">=</span> underwear
<span class="token punctuation">}</span>

<span class="token class-name">Model</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">takePhoto</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'sex= '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">+</span> <span class="token string">' underwear= '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>underwear<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> maleModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">'male'</span><span class="token punctuation">,</span> <span class="token string">'underwear'</span> <span class="token operator">+</span> i<span class="token punctuation">)</span>
  maleModel<span class="token punctuation">.</span><span class="token function">takePhoto</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">50</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> femaleModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">'female'</span><span class="token punctuation">,</span> <span class="token string">'underwear '</span> <span class="token operator">+</span> j<span class="token punctuation">)</span>
  femaleModel<span class="token punctuation">.</span><span class="token function">takePhoto</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 修改</span>
<span class="token keyword">var</span> <span class="token function-variable function">Model</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">sex<span class="token punctuation">,</span> underwear</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex
<span class="token punctuation">}</span>

<span class="token class-name">Model</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">takePhoto</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'sex= '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">+</span> <span class="token string">' underwear= '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>underwear<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> maleModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">'male'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> femaleMode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token string">'female'</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  maleModel<span class="token punctuation">.</span>underwear <span class="token operator">=</span> <span class="token string">'underwear'</span> <span class="token operator">+</span> i
  maleModel<span class="token punctuation">.</span><span class="token function">takePhoto</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">50</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  femaleModel<span class="token punctuation">.</span>underwear <span class="token operator">=</span> <span class="token string">'underwear '</span> <span class="token operator">+</span> j
  femaleModel<span class="token punctuation">.</span><span class="token function">takePhoto</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>  改进之后，就是只需要两个对象就可以了。不需要重复创建很多对象。上面的代码是享元模式的雏形，它要求将对象的属性划分为内部属性和外部属性。享元模式的目标是尽量减少共享对象的数量。关于如何划分内部状态和外部状态。可以通过几点来做区分。1 内部状态存储于对象内部。2 内部状态可以被一些对象共享。3 内部状态独立于具体的场景，通常不会改变。4 外部状态取决于具体的场景，并根据场景而变化。外部状态不能背共享。（完）通过拆分内部和外部属性，虽然组合外部属性时会花费一些时间，但可以减少系统中的对象数量。所以这是一种时间换空间的优化模式。</p> <p>  上面代码中有两个问题。1 我们通过 new 了两个 model 对象，在其他系统中，也许并不是一开始就需要所有的共享对象。2 给 model 对象设置了 underware 的外部属性，在复杂系统中，这不是一个好的方式。我们通过对象工厂来解决第一个问题，第二个问题，可以用一个管理器来记录对象相关的外部状态。使这些外部状态通过某个钩子和共享对象联系起来。</p> <p>  我们讲下对象池，对象池维护一个装载空闲对象的池子，如果需要对象的时候，不是之间 new，而是从对象池中获取。如果对象池里么有空闲对象，则创建一个新的对象，当获取出的对象完成它的职责之后，再进入池子等待下次获取。对象池技术的应用非常广泛，http 连接池和数据库连接池都是其代表应用。在 web 前端开发中，对象池使用最多的场景大概就是跟 dom 有关的操作。假设我们开发一个地图应用，地图上经常会出现一些标志地名的小气泡，我们叫他 toolTip。比如搜索我们附近时出现两个小气泡，搜索兰州拉面的时候，出现了 6 个。按照对象池的思想，在第二次搜索开始之前，不会把第一次创建的 2 个小气泡删除掉，而是把他们放进对象池，这样第第二次的搜索结果页面里，我们只需要再创建 4 个小气泡而不是 6 个。我们先定义一个获取小气泡节点的工厂，作为对象池的数组成为私有属性被包含在工厂闭包里，这个工厂有两个暴露对外的方法，create 表示获取一个 div 节点，recover 表示回收一个 div 节点。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> toolTipFactory <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> toolTipPool <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">create</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>toolTipPool<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span>
        <span class="token keyword">return</span> div
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> toolTipPool<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">recover</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tooltipDom</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> toolTipPool<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>tooltipDom<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> ary <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> str<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> toolTip <span class="token operator">=</span> toolTipFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  toolTip<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> str<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
  ary<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>toolTip<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>  接下来假设地图需要开始重新绘制，在此之前需要把两个节点回收到对象池，然后再生成 6 个气泡。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'button1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ary<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    toolTipFactory<span class="token punctuation">.</span><span class="token function">recover</span><span class="token punctuation">(</span>toolTip<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">,</span> <span class="token string">'f'</span><span class="token punctuation">]</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> str<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> el <span class="token operator">=</span> str<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token keyword">let</span> tt <span class="token operator">=</span> toolTipFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    tt<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> el
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>  现在再测试一番，页面中出现了6个节点。对象池和享元模式的思想有点相似，虽然这里没有粉笔内部属性和外部属性。以后遇到大量相似对象的系统，享元模式的思想可以给我们解决性能问题。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/alblog/read/designMode/13.html" class="prev">
        js设计模式与开发实践13
      </a></span> <span class="next"><a href="/alblog/read/designMode/11.html">
        js设计模式与开发实践11
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/alblog/assets/js/app.355d6781.js" defer></script><script src="/alblog/assets/js/2.03ebf054.js" defer></script><script src="/alblog/assets/js/41.36460a4d.js" defer></script>
  </body>
</html>
